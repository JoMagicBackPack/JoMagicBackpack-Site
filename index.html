<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Jo’MagicBackpack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --gap: 14px; --cardW: 200px; --imgH: 160px; }
    body { margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#111; }
    header { padding:18px 16px; border-bottom:1px solid #eee; }
    main { padding:16px; }

    /* Fresh in the Backpack: simple horizontal carousel */
    .rail {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: var(--cardW);
      gap: var(--gap);
      overflow-x: auto;
      overscroll-behavior-x: contain;
      scroll-snap-type: x mandatory;
      padding-bottom: 8px;
    }
    .rail::-webkit-scrollbar { height: 8px; }
    .rail::-webkit-scrollbar-thumb { background:#ccc; border-radius: 8px; }
    .card { scroll-snap-align: start; }
    .card a { display:block; text-decoration:none; color:inherit; }
    .card img {
      width:100%; height: var(--imgH); object-fit: cover; border-radius: 12px; background:#f5f5f5;
    }
    .title { margin-top:8px; font-size:14px; line-height:1.35; }
    .price { font-weight:700; margin-top:4px; font-size:14px; }
    #ebay-carousel { margin-top: 12px; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;">Jo’MagicBackpack</h1>
  </header>

  <main>
    <!-- Your other content here -->

    <!-- Fresh in the Backpack (drop-in) -->
    <section id="fresh" style="margin-top: 24px;">
      <h2 style="margin:0 0 8px; font:600 20px/1.2 system-ui,-apple-system,Segoe UI,Roboto;">Fresh in the Backpack</h2>
      <div id="ebay-carousel">Loading…</div>
    </section>
  </main>

  <!-- Fetch + render listings -->
  <script>
  (async () => {
    const mount = document.getElementById('ebay-carousel');
    try {
      const res = await fetch('/.netlify/functions/ebay-listings?limit=12', { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();           // { source, count, items: [...] }
      const items = Array.isArray(data.items) ? data.items : [];
      if (!items.length) { mount.textContent = 'No items right now.'; return; }

      // Upgrade ebay images from s-l140.jpg → s-l500.jpg when possible
      const big = (u) => u ? u.replace(/s-l\d+\.jpg/i, 's-l500.jpg') : '';

      mount.innerHTML = `
        <div class="rail" aria-label="Fresh eBay items">
          ${items.map(it => `
            <div class="card">
              <a href="${it.url}" target="_blank" rel="noopener">
                <img src="${big(it.image)}" alt="${(it.title||'').replace(/"/g,'&quot;')}" loading="lazy">
                <div class="title">${(it.title||'').slice(0,70)}${(it.title||'').length>70?'…':''}</div>
                <div class="price">$${Number(it.price).toFixed(2)}</div>
              </a>
            </div>
          `).join('')}
        </div>
      `;
    } catch (err) {
      console.error('eBay carousel error:', err);
      mount.textContent = 'eBay items unavailable right now.';
    }
  })();
  </script>
</body>
</html>
